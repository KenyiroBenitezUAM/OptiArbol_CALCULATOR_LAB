<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calculadora de Valores Esperados - Árbol de Decisiones</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;600;700;800;900&family=Inter:wght@100;200;300;400;500;600;700;800;900&display=swap');
        @import url('https://fonts.googleapis.com/css2?family=The+Seasons:wght@400;700&display=swap');
        
        * {
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
        
        body { 
            font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Display', 'SF Pro Text', Inter, sans-serif;
            letter-spacing: -0.01em;
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 25%, #cbd5e1 50%, #94a3b8 75%, #64748b 100%);
            min-height: 100vh;
        }
        
        .apple-card {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1), 
                        inset 0 1px 0 rgba(255, 255, 255, 0.8);
        }
        
        .apple-section {
            transition: all 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
        }
        
        .apple-section:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.15);
        }
        
        .apple-button {
            background: linear-gradient(135deg, #007AFF 0%, #0051D5 100%);
            border: none;
            border-radius: 12px;
            color: white;
            font-weight: 600;
            letter-spacing: -0.01em;
            transition: all 0.2s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            box-shadow: 0 4px 16px rgba(0, 122, 255, 0.3);
        }
        
        .apple-button:hover {
            background: linear-gradient(135deg, #0051D5 0%, #003D99 100%);
            transform: translateY(-1px);
            box-shadow: 0 8px 24px rgba(0, 122, 255, 0.4);
        }
        
        .apple-button:active {
            transform: translateY(0px);
            box-shadow: 0 2px 8px rgba(0, 122, 255, 0.3);
        }
        
        .apple-input {
            border: 1px solid rgba(0, 0, 0, 0.1);
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.9);
            color: #1d1d1f;
            transition: all 0.2s ease;
            font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Text', sans-serif;
        }
        
        .apple-input:focus {
            border-color: #007AFF;
            box-shadow: 0 0 0 3px rgba(0, 122, 255, 0.2);
            outline: none;
            background: rgba(255, 255, 255, 1);
        }
        
        .node-circle {
            fill: #007AFF;
            stroke: #0051D5;
            stroke-width: 2;
            filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.1));
        }
        
        .node-optimal {
            fill: #34C759;
            stroke: #28A745;
            filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.1));
        }
        
        .node-text {
            fill: white;
            font-size: 12px;
            font-weight: 600;
            text-anchor: middle;
            dominant-baseline: middle;
            font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Text', sans-serif;
        }
        
        .link {
            fill: none;
            stroke: #8E8E93;
            stroke-width: 2;
            opacity: 0.8;
        }
        
        .link-text {
            fill: #3A3A3C;
            font-size: 11px;
            text-anchor: middle;
            font-weight: 500;
            font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Text', sans-serif;
        }
        
        .start-node {
            fill: #007AFF;
            stroke: #0051D5;
            filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.1));
        }
        
        .outcome-node {
            fill: #F2F2F7;
            stroke: #C7C7CC;
        }
        
        .outcome-text {
            fill: #1D1D1F;
            font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Text', sans-serif;
        }
    </style>
</head>
<body class="min-h-screen p-4">

    <!-- Section 1: Splash Screen -->
    <section class="min-h-screen flex flex-col items-center justify-center" style="background-color: #3b475e;">
        <div class="text-center">
            <h1 class="text-6xl md:text-7xl font-bold text-white mb-12" style="font-family: 'The Seasons', serif; font-weight: 700; letter-spacing: 0.02em;">
                OptiArbol CALCULATOR-LAB
            </h1>
            <div class="w-48 h-48 mx-auto bg-white rounded-full flex items-center justify-center shadow-2xl mb-12" style="box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);">
                <img src="https://raw.githubusercontent.com/KenyiroBenitezUAM/OptiArbol_CALCULATOR_LAB/main/logo.png" 
                     alt="OptiArbol Logo" 
                     class="w-40 h-40 object-contain rounded-full">
            </div>
            <div class="flex flex-col items-center">
                <p class="text-white text-xl font-medium mb-8" style="font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Text', sans-serif;">
                    Desplázate hacia abajo para explorar
                </p>
                <div class="animate-bounce">
                    <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M19 14l-7 7m0 0l-7-7m7 7V3"></path>
                    </svg>
                </div>
            </div>
        </div>
    </section>
    
    <!-- Section 2: University Information -->
    <section class="min-h-screen flex items-center justify-center py-20">
        <div class="text-center max-w-5xl mx-auto px-6">
            <div class="apple-card rounded-2xl p-8 apple-section">
                <div class="flex justify-center items-center gap-8 mb-6">
                    <img src="https://politicaycultura.xoc.uam.mx/wp-content/uploads/2023/08/logo-uam-50-xochimilco_2.png" 
                         alt="Logo UAM Xochimilco" 
                         class="h-20 w-auto"
                         style="filter: drop-shadow(0 4px 8px rgba(0, 0, 0, 0.1));">
                    <img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcTRjtH5mU7ZUpqWQWJidG989f5ThORJ7ymssg&s" 
                         alt="Logo Política y Gestión Social" 
                         class="h-20 w-auto"
                         style="filter: drop-shadow(0 4px 8px rgba(0, 0, 0, 0.1));">
                </div>
                <h1 class="text-2xl font-bold text-gray-900 mb-3" style="font-weight: 700; letter-spacing: -0.02em;">UNIVERSIDAD AUTÓNOMA METROPOLITANA</h1>
                <h2 class="text-lg font-semibold text-gray-800 mb-2" style="font-weight: 600;">Unidad Xochimilco</h2>
                <h3 class="text-base text-gray-700 mb-2" style="font-weight: 500;">División de Ciencias Sociales y Humanidades</h3>
                <h4 class="text-base text-gray-700 mb-6" style="font-weight: 500;">Política y Gestión Social</h4>
                <div class="border-t border-gray-200 pt-6">
                    <h2 class="text-xl font-bold text-gray-900 mb-6" style="font-weight: 700; letter-spacing: -0.01em;">Proyecto Final: Calculadora de Valores Esperados con Árbol de Decisiones Gráfico</h2>
                    <div class="text-sm text-gray-800 space-y-2" style="font-weight: 400;">
                        <p><strong style="font-weight: 600;">Presentado por:</strong></p>
                        <p>Benítez Pérez, Martínez Mendoza, Altamirano Medina, López Miranda</p>
                        <div class="mt-6 space-y-2">
                            <p><strong style="font-weight: 600;">Profesor:</strong> Dr. Guerrero Sánchez</p>
                            <p><strong style="font-weight: 600;">Grupo:</strong> S02G</p>
                            <p><strong style="font-weight: 600;">Fecha:</strong> 10 de Junio de 2025</p>
                            <p><strong style="font-weight: 600;">Ciudad de México, México</strong></p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Section 3: Project Description -->
    <section class="min-h-screen flex items-center justify-center py-20">
        <div class="text-center max-w-5xl mx-auto px-6">
            <div class="apple-card rounded-2xl p-8 apple-section">
                <h2 class="text-2xl font-bold text-gray-900 mb-6" style="font-weight: 700; letter-spacing: -0.02em;">Árbol de Decisiones y Análisis de Rendimiento</h2>
                <div class="text-left text-gray-700 leading-relaxed mb-6">
                    <p class="mb-4">
                        <strong>Descripción:</strong> Esta aplicación permite tomar decisiones óptimas al calcular el rendimiento esperado y aplicar criterios de decisión como Maximax, Maximin, Laplace y Minimax, además del valor esperado. El usuario ingresa una matriz 4×4 de rendimientos y un vector de probabilidades. El sistema calcula los resultados para cada criterio y genera un árbol de decisiones visual, destacando la opción óptima basada en el valor esperado.
                    </p>
                </div>
                <div class="space-y-4">
                    <details class="bg-blue-50/50 rounded-xl p-6 apple-section border border-blue-100/50">
                        <summary class="font-semibold text-blue-900 cursor-pointer hover:text-blue-800 transition-colors" style="font-weight: 600; letter-spacing: -0.01em;">Metodología Matemática</summary>
                        <div class="mt-3 text-sm text-gray-700 space-y-3">
                            <div>
                                <h4 class="font-medium text-gray-800">1. Multiplicación de Matriz por Vector (Valor Esperado)</h4>
                                <p>La matriz M de 4×4 representa los rendimientos de cuatro opciones bajo cuatro escenarios. El vector de probabilidades P = [p₁, p₂, p₃, p₄] debe cumplir que la suma de sus elementos sea 1. El rendimiento esperado de cada opción se calcula sumando el producto de cada rendimiento por su probabilidad correspondiente. Los resultados se redondean a tres decimales.</p>
                            </div>
                            <div>
                                <h4 class="font-medium text-gray-800">2. Criterio Maximax</h4>
                                <p>Selecciona la opción con el mayor rendimiento posible en cualquier escenario, optimista pero arriesgada.</p>
                            </div>
                            <div>
                                <h4 class="font-medium text-gray-800">3. Criterio Maximin</h4>
                                <p>Elige la opción con el mejor rendimiento en el peor escenario, siendo conservadora.</p>
                            </div>
                            <div>
                                <h4 class="font-medium text-gray-800">4. Criterio Laplace</h4>
                                <p>Asume probabilidades iguales (0.25) para cada escenario y calcula el valor esperado, seleccionando la opción con el mayor resultado.</p>
                            </div>
                            <div>
                                <h4 class="font-medium text-gray-800">5. Criterio Minimax</h4>
                                <p>Construye una matriz de arrepentimiento (diferencia entre el máximo rendimiento por escenario y el rendimiento real) y selecciona la opción que minimiza el arrepentimiento máximo.</p>
                            </div>
                            <div>
                                <h4 class="font-medium text-gray-800">6. Normalización del Vector de Probabilidades</h4>
                                <p>Si la suma de probabilidades no es exactamente 1, el sistema las normaliza automáticamente para asegurar cálculos válidos.</p>
                            </div>
                            <div>
                                <h4 class="font-medium text-gray-800">7. Visualización del Árbol de Decisiones</h4>
                                <p>El árbol incluye un nodo inicial de decisión (rombo), cuatro nodos de opciones conectados con sus probabilidades, ramificaciones a cuatro escenarios con los valores de rendimiento correspondientes. La opción con el mayor valor esperado se resalta en verde.</p>
                            </div>
                        </div>
                    </details>
                    <details class="bg-green-50/50 rounded-xl p-6 apple-section border border-green-100/50">
                        <summary class="font-semibold text-green-900 cursor-pointer hover:text-green-800 transition-colors" style="font-weight: 600; letter-spacing: -0.01em;">Historia y Contribuciones Clave</summary>
                        <div class="mt-3 text-sm text-gray-700">
                            <p class="mb-2">Los árboles de decisión surgen de la teoría de la información, estadística e informática. Contribuciones importantes incluyen:</p>
                            <ul class="list-disc list-inside space-y-1 ml-4">
                                <li>Pioneros que introdujeron la teoría de la información y la entropía, base de la ganancia de información</li>
                                <li>Investigadores en los años 50 que desarrollaron métodos iniciales de partición de datos</li>
                                <li>Creadores de programas tempranos de árboles de regresión en los 60s</li>
                                <li>Desarrolladores de algoritmos para árboles de clasificación en los 80s</li>
                                <li>Autores de métodos basados en índices estadísticos para mejorar el desempeño</li>
                                <li>Innovadores en algoritmos que usan pruebas estadísticas para particionar datos</li>
                            </ul>
                        </div>
                    </details>
                    <details class="bg-purple-50/50 rounded-xl p-6 apple-section border border-purple-100/50">
                        <summary class="font-semibold text-purple-900 cursor-pointer hover:text-purple-800 transition-colors" style="font-weight: 600; letter-spacing: -0.01em;">Ventajas, Desventajas y Optimización</summary>
                        <div class="mt-3 text-sm text-gray-700 space-y-3">
                            <div>
                                <h4 class="font-medium text-green-700">Ventajas</h4>
                                <ul class="list-disc list-inside ml-4">
                                    <li>Interpretación visual clara y sencilla</li>
                                    <li>Manejo de datos numéricos y categóricos</li>
                                    <li>No requiere normalización previa de datos</li>
                                    <li>Transparencia en el proceso de decisión</li>
                                </ul>
                            </div>
                            <div>
                                <h4 class="font-medium text-red-700">Desventajas</h4>
                                <ul class="list-disc list-inside ml-4">
                                    <li>Riesgo de sobreajuste sin técnicas adecuadas</li>
                                    <li>Sensibilidad alta a variaciones en los datos</li>
                                </ul>
                            </div>
                            <div>
                                <h4 class="font-medium text-blue-700">Técnicas de Optimización</h4>
                                <ul class="list-disc list-inside ml-4">
                                    <li>Poda para eliminar ramas irrelevantes</li>
                                    <li>Uso de conjuntos de árboles que mejoran precisión y reducen sobreajuste</li>
                                    <li>Selección cuidadosa de características para optimizar rendimiento</li>
                                </ul>
                            </div>
                        </div>
                    </details>
                    <details class="bg-gray-50/50 rounded-xl p-6 apple-section border border-gray-100/50">
                        <summary class="font-semibold text-gray-900 cursor-pointer hover:text-gray-800 transition-colors" style="font-weight: 600; letter-spacing: -0.01em;">Conclusión</summary>
                        <div class="mt-3 text-sm text-gray-700">
                            <p>Este programa combina cálculos matemáticos avanzados con visualización clara para apoyar la toma de decisiones fundamentadas. Incorpora criterios como Maximax, Maximin, Laplace, Minimax y Valor Esperado, inspirándose en avances en algoritmos de árboles de decisión, ofreciendo una herramienta accesible y precisa.</p>
                        </div>
                    </details>
                </div>
            </div>
        </div>
    </section>
    
    <!-- Section 4: Features Overview -->
    <section class="min-h-screen flex items-center justify-center py-20">
        <div class="text-center max-w-5xl mx-auto px-6">
            <div class="mb-12">
                <div class="w-32 h-32 mx-auto bg-gradient-to-br from-blue-500 to-blue-600 rounded-3xl flex items-center justify-center shadow-2xl apple-section" style="box-shadow: 0 20px 60px rgba(0, 122, 255, 0.3);">
                    <svg class="w-16 h-16 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="1.5">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M9 19მო�

System: 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                    </svg>
                </div>
            </div>
            <h1 class="text-5xl md:text-6xl font-bold text-gray-900 mb-8 leading-tight" style="font-weight: 800; letter-spacing: -0.03em;">
                <span class="bg-gradient-to-r from-blue-600 to-blue-500 bg-clip-text text-transparent">
                    Calculadora de Valores Esperados
                </span>
            </h1>
            <p class="text-xl md:text-2xl text-gray-700 mb-12 leading-relaxed" style="font-weight: 400; letter-spacing: -0.01em;">
                Herramienta interactiva para análisis de decisiones<br>
                con visualización de árboles y criterios múltiples
            </p>
            <div class="grid md:grid-cols-3 gap-8 mb-16">
                <div class="apple-card rounded-2xl p-8 apple-section">
                    <div class="w-16 h-16 bg-blue-100 rounded-2xl flex items-center justify-center mb-6 mx-auto">
                        <svg class="w-8 h-8 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="1.5">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M9 7h6m0 10v-3m-3 3h.01M9 17h.01M9 14h.01M12 14h.01M15 11h.01M12 11h.01M9 11h.01M7 21h10a2 2 0 002-2V5a2 2 0 00-2-2H7a2 2 0 00-2 2v14a2 2 0 002 2z"></path>
                        </svg>
                    </div>
                    <h3 class="text-xl font-semibold text-gray-900 mb-3" style="font-weight: 600; letter-spacing: -0.01em;">Cálculo Avanzado</h3>
                    <p class="text-gray-700 text-base" style="font-weight: 400;">Soporte para Maximax, Maximin, Laplace, Minimax y Valor Esperado</p>
                </div>
                <div class="apple-card rounded-2xl p-8 apple-section">
                    <div class="w-16 h-16 bg-green-100 rounded-2xl flex items-center justify-center mb-6 mx-auto">
                        <svg class="w-8 h-8 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="1.5">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M5 3v4M3 5h4M6 17v4m-2-2h4m5-16l2.286 6.857L21 12l-5.714 2.143L13 21l-2.286-6.857L5 12l5.714-2.143L13 3z"></path>
                        </svg>
                    </div>
                    <h3 class="text-xl font-semibold text-gray-900 mb-3" style="font-weight: 600; letter-spacing: -0.01em;">Visualización</h3>
                    <p class="text-gray-700 text-base" style="font-weight: 400;">Árbol interactivo con la opción óptima (Valor Esperado) resaltada</p>
                </div>
                <div class="apple-card rounded-2xl p-8 apple-section">
                    <div class="w-16 h-16 bg-purple-100 rounded-2xl flex items-center justify-center mb-6 mx-auto">
                        <svg class="w-8 h-8 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="1.5">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M12 18h.01M8 21h8a2 2 0 002-2V5a2 2 0 00-2-2H8a2 2 0 00-2 2v14a2 2 0 002 2z"></path>
                        </svg>
                    </div>
                    <h3 class="text-xl font-semibold text-gray-900 mb-3" style="font-weight: 600; letter-spacing: -0.01em;">Responsivo</h3>
                    <p class="text-gray-700 text-base" style="font-weight: 400;">Diseño adaptable para Google Colab en dispositivos móviles y escritorio</p>
                </div>
            </div>
        </div>
    </section>

    <!-- Section 5: Calculator -->
    <section class="min-h-screen py-20">
        <div class="max-w-6xl mx-auto px-6">
            <div class="text-center mb-12">
                <h1 class="text-4xl font-bold text-gray-900 mb-4" style="font-weight: 700; letter-spacing: -0.02em;">Calculadora de Valores Esperados</h1>
                <p class="text-xl text-gray-700" style="font-weight: 400;">Árbol de Decisiones Interactivo con Criterios de Decisión</p>
            </div>
            <div class="grid lg:grid-cols-2 gap-8">
                <div class="apple-card rounded-2xl p-8">
                    <h2 class="text-2xl font-semibold text-gray-900 mb-8" style="font-weight: 600; letter-spacing: -0.01em;">Datos de Entrada</h2>
                    <div class="mb-6">
                        <label class="block text-sm font-medium text-gray-700 mb-3">Matriz de Rendimientos (4×4)</label>
                        <div class="grid grid-cols-4 gap-2" id="matrix-inputs">
                        </div>
                    </div>
                    <div class="mb-6">
                        <label class="block text-sm font-medium text-gray-700 mb-3">Vector de Probabilidades</label>
                        <div class="grid grid-cols-4 gap-2" id="prob-inputs">
                        </div>
                        <p class="text-xs text-gray-500 mt-2">Las probabilidades se normalizarán automáticamente si no suman 1.0</p>
                    </div>
                    <button id="calculate-btn" class="w-full apple-button py-3 px-4 text-base">
                        Calcular Criterios
                    </button>
                    <div id="results" class="mt-6 hidden">
                        <h3 class="text-lg font-semibold text-gray-800 mb-3">Resultados</h3>
                        <div id="decision-criteria" class="space-y-4 mb-4"></div>
                    </div>
                </div>
                <div class="apple-card rounded-2xl p-8">
                    <h2 class="text-2xl font-semibold text-gray-900 mb-6" style="font-weight: 600; letter-spacing: -0.01em;">Árbol de Decisiones</h2>
                    <div id="tree-container" class="w-full h-96 border border-gray-200 rounded-lg flex items-center justify-center text-gray-500 overflow-x-auto">
                        <p>Ingrese los datos y haga clic en "Calcular" para generar el árbol</p>
                    </div>
                    <button id="download-btn" class="w-full apple-button py-3 px-4 text-base mt-4 hidden">
                        Descargar Árbol como PNG
                    </button>
                </div>
            </div>
            <div class="mt-8 apple-card rounded-2xl p-8">
                <h3 class="text-2xl font-semibold text-gray-900 mb-6" style="font-weight: 600; letter-spacing: -0.01em;">Instrucciones de Uso</h3>
                <div class="grid md:grid-cols-2 gap-6 text-sm text-gray-600">
                    <div>
                        <h4 class="font-medium text-gray-800 mb-2">Matriz de Rendimientos:</h4>
                        <p>Ingrese los valores de rendimiento para cada opción (filas) bajo cada escenario (columnas).</p>
                    </div>
                    <div>
                        <h4 class="font-medium text-gray-800 mb-2">Probabilidades:</h4>
                        <p>Ingrese las probabilidades de cada escenario. Se normalizarán automáticamente.</p>
                    </div>
                    <div>
                        <h4 class="font-medium text-gray-800 mb-2">Criterios de Decisión:</h4>
                        <p>La calculadora evalúa Maximax, Maximin, Laplace, Minimax y Valor Esperado, destacando la opción óptima basada en el valor esperado en el árbol.</p>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Footer Section -->
    <div class="text-center text-base text-gray-600 py-8" style="font-weight: 400;">
        <p>Desarrollado para Google Colab • Universidad Autónoma Metropolitana Xochimilco</p>
        <p class="mt-2">Política y Gestión Social • Análisis de Decisiones Avanzado</p>
    </div>

    <script>
        // Initialize input fields
        function initializeInputs() {
            const matrixContainer = document.getElementById('matrix-inputs');
            const probContainer = document.getElementById('prob-inputs');
            
            for (let i = 0; i < 16; i++) {
                const input = document.createElement('input');
                input.type = 'number';
                input.step = '0.001';
                input.value = '0';
                input.className = 'w-full px-2 py-2 apple-input text-sm';
                input.id = `matrix-${i}`;
                matrixContainer.appendChild(input);
            }
            
            for (let i = 0; i < 4; i++) {
                const input = document.createElement('input');
                input.type = 'number';
                input.step = '0.001';
                input.value = '0.25';
                input.className = 'w-full px-2 py-2 apple-input text-sm';
                input.id = `prob-${i}`;
                probContainer.appendChild(input);
            }
        }

        // Calculate decision criteria
        function calculateDecisionCriteria() {
            // Get matrix values
            const matrix = [];
            for (let i = 0; i < 4; i++) {
                const row = [];
                for (let j = 0; j < 4; j++) {
                    const value = parseFloat(document.getElementById(`matrix-${i * 4 + j}`).value) || 0;
                    row.push(value);
                }
                matrix.push(row);
            }
            
            // Get probability values
            let probabilities = [];
            for (let i = 0; i < 4; i++) {
                const value = parseFloat(document.getElementById(`prob-${i}`).value) || 0;
                probabilities.push(value);
            }
            
            // Normalize probabilities
            const sum = probabilities.reduce((a, b) => a + b, 0);
            if (sum > 0) {
                probabilities = probabilities.map(p => p / sum);
            } else {
                probabilities = [0.25, 0.25, 0.25, 0.25]; // Default to equal probabilities if sum is 0
            }
            
            // Expected Value
            const expectedValues = matrix.map(row => {
                return row.reduce((sum, value, index) => sum + value * probabilities[index], 0);
            });
            const maxExpectedValue = Math.max(...expectedValues);
            const expectedValueIndex = expectedValues.indexOf(maxExpectedValue);
            
            // Maximax
            const maxPerOption = matrix.map(row => Math.max(...row));
            const maximaxValue = Math.max(...maxPerOption);
            const maximaxIndex = maxPerOption.indexOf(maximaxValue);
            
            // Maximin
            const minPerOption = matrix.map(row => Math.min(...row));
            const maximinValue = Math.max(...minPerOption);
            const maximinIndex = minPerOption.indexOf(maximinValue);
            
            // Laplace
            const laplaceValues = matrix.map(row => row.reduce((sum, value) => sum + value * 0.25, 0));
            const laplaceValue = Math.max(...laplaceValues);
            const laplaceIndex = laplaceValues.indexOf(laplaceValue);
            
            // Minimax (Regret)
            const maxPerScenario = matrix[0].map((_, colIndex) => Math.max(...matrix.map(row => row[colIndex])));
            const regretMatrix = matrix.map(row => row.map((value, colIndex) => maxPerScenario[colIndex] - value));
            const maxRegretPerOption = regretMatrix.map(row => Math.max(...row));
            const minimaxValue = Math.min(...maxRegretPerOption);
            const minimaxIndex = maxRegretPerOption.indexOf(minimaxValue);
            
            return {
                matrix,
                probabilities,
                expectedValues,
                expectedValueIndex,
                maxExpectedValue,
                maximaxIndex,
                maximaxValue,
                maximinIndex,
                maximinValue,
                laplaceIndex,
                laplaceValue,
                minimaxIndex,
                minimaxValue,
                regretMatrix
            };
        }

        // Display results
        function displayResults(results) {
            const resultsDiv = document.getElementById('results');
            const criteriaDiv = document.getElementById('decision-criteria');
            
            criteriaDiv.innerHTML = '';
            
            // Expected Value Results
            const evDiv = document.createElement('div');
            evDiv.className = 'space-y-2';
            evDiv.innerHTML = `<h4 class="font-medium text-gray-800">Valor Esperado</h4>`;
            results.expectedValues.forEach((value, index) => {
                const div = document.createElement('div');
                div.className = `flex justify-between items-center py-2 px-3 rounded-md ${
                    index === results.expectedValueIndex ? 'bg-green-100 border border-green-300' : 'bg-gray-50'
                }`;
                div.innerHTML = `
                    <span class="font-medium">Opción ${index + 1}:</span>
                    <span class="font-mono">${value.toFixed(3)}</span>
                `;
                evDiv.appendChild(div);
            });
            evDiv.innerHTML += `
                <div class="flex items-center bg-green-50 border border-green-200 rounded-lg p-3 mt-2">
                    <div class="w-3 h-3 bg-green-500 rounded-full mr-2"></div>
                    <span class="font-medium text-green-800">
                        Opción Óptima: ${results.expectedValueIndex + 1} (VE: ${results.maxExpectedValue.toFixed(3)})
                    </span>
                </div>
            `;
            
            // Maximax Results
            const maximaxDiv = document.createElement('div');
            maximaxDiv.className = 'space-y-2';
            maximaxDiv.innerHTML = `<h4 class="font-medium text-gray-800">Maximax</h4>`;
            results.matrix.forEach((row, index) => {
                const maxValue = Math.max(...row);
                const div = document.createElement('div');
                div.className = `flex justify-between items-center py-2 px-3 rounded-md ${
                    index === results.maximaxIndex ? 'bg-blue-100 border border-blue-300' : 'bg-gray-50'
                }`;
                div.innerHTML = `
                    <span class="font-medium">Opción ${index + 1} (Máx.):</span>
                    <span class="font-mono">${maxValue.toFixed(3)}</span>
                `;
                maximaxDiv.appendChild(div);
            });
            maximaxDiv.innerHTML += `
                <div class="flex items-center bg-blue-50 border border-blue-200 rounded-lg p-3 mt-2">
                    <div class="w-3 h-3 bg-blue-500 rounded-full mr-2"></div>
                    <span class="font-medium text-blue-800">
                        Opción Óptima: ${results.maximaxIndex + 1} (Máx.: ${results.maximaxValue.toFixed(3)})
                    </span>
                </div>
            `;
            
            // Maximin Results
            const maximinDiv = document.createElement('div');
            maximinDiv.className = 'space-y-2';
            maximinDiv.innerHTML = `<h4 class="font-medium text-gray-800">Maximin</h4>`;
            results.matrix.forEach((row, index) => {
                const minValue = Math.min(...row);
                const div = document.createElement('div');
                div.className = `flex justify-between items-center py-2 px-3 rounded-md ${
                    index === results.maximinIndex ? 'bg-yellow-100 border border-yellow-300' : 'bg-gray-50'
                }`;
                div.innerHTML = `
                    <span class="font-medium">Opción ${index + 1} (Mín.):</span>
                    <span class="font-mono">${minValue.toFixed(3)}</span>
                `;
                maximinDiv.appendChild(div);
            });
            maximinDiv.innerHTML += `
                <div class="flex items-center bg-yellow-50 border border-yellow-200 rounded-lg p-3 mt-2">
                    <div class="w-3 h-3 bg-yellow-500 rounded-full mr-2"></div>
                    <span class="font-medium text-yellow-800">
                        Opción Óptima: ${results.maximinIndex + 1} (Mín.: ${results.maximinValue.toFixed(3)})
                    </span>
                </div>
            `;
            
            // Laplace Results
            const laplaceDiv = document.createElement('div');
            laplaceDiv.className = 'space-y-2';
            laplaceDiv.innerHTML = `<h4 class="font-medium text-gray-800">Laplace</h4>`;
            results.matrix.forEach((row, index) => {
                const laplaceValue = row.reduce((sum, value) => sum + value * 0.25, 0);
                const div = document.createElement('div');
                div.className = `flex justify-between items-center py-2 px-3 rounded-md ${
                    index === results.laplaceIndex ? 'bg-purple-100 border border-purple-300' : 'bg-gray-50'
                }`;
                div.innerHTML = `
                    <span class="font-medium">Opción ${index + 1}:</span>
                    <span class="font-mono">${laplaceValue.toFixed(3)}</span>
                `;
                laplaceDiv.appendChild(div);
            });
            laplaceDiv.innerHTML += `
                <div class="flex items-center bg-purple-50 border border-purple-200 rounded-lg p-3 mt-2">
                    <div class="w-3 h-3 bg-purple-500 rounded-full mr-2"></div>
                    <span class="font-medium text-purple-800">
                        Opción Óptima: ${results.laplaceIndex + 1} (VE: ${results.laplaceValue.toFixed(3)})
                    </span>
                </div>
            `;
            
            // Minimax Results
            const minimaxDiv = document.createElement('div');
            minimaxDiv.className = 'space-y-2';
            minimaxDiv.innerHTML = `<h4 class="font-medium text-gray-800">Minimax (Arrepentimiento)</h4>`;
            results.regretMatrix.forEach((row, index) => {
                const maxRegret = Math.max(...row);
                const div = document.createElement('div');
                div.className = `flex justify-between items-center py-2 px-3 rounded-md ${
                    index === results.minimaxIndex ? 'bg-red-100 border border-red-300' : 'bg-gray-50'
                }`;
                div.innerHTML = `
                    <span class="font-medium">Opción ${index + 1} (Máx. Arrepent.):</span>
                    <span class="font-mono">${maxRegret.toFixed(3)}</span>
                `;
                minimaxDiv.appendChild(div);
            });
            minimaxDiv.innerHTML += `
                <div class="flex items-center bg-red-50 border border-red-200 rounded-lg p-3 mt-2">
                    <div class="w-3 h-3 bg-red-500 rounded-full mr-2"></div>
                    <span class="font-medium text-red-800">
                        Opción Óptima: ${results.minimaxIndex + 1} (Máx. Arrepent.: ${results.minimaxValue.toFixed(3)})
                    </span>
                </div>
            `;
            
            criteriaDiv.appendChild(evDiv);
            criteriaDiv.appendChild(maximaxDiv);
            criteriaDiv.appendChild(maximinDiv);
            criteriaDiv.appendChild(laplaceDiv);
            criteriaDiv.appendChild(minimaxDiv);
            
            resultsDiv.classList.remove('hidden');
        }

        // Generate decision tree
        function generateTree(results) {
            const container = document.getElementById('tree-container');
            container.innerHTML = '';
            
            const width = 600;
            const height = 400;
            
            const svg = d3.select('#tree-container')
                .append('svg')
                .attr('width', width)
                .attr('height', height)
                .attr('viewBox', `0 0 ${width} ${height}`)
                .attr('preserveAspectRatio', 'xMidYMid meet');
            
            const startX = 80;
            const startY = height / 2;
            const optionX = 250;
            const outcomeX = 420;
            
            // Draw start node as diamond
            svg.append('polygon')
                .attr('points', `${startX},${startY-25} ${startX+25},${startY} ${startX},${startY+25} ${startX-25},${startY}`)
                .attr('class', 'start-node');
            
            svg.append('text')
                .attr('x', startX)
                .attr('y', startY)
                .attr('class', 'node-text')
                .text('Inicio');
            
            results.expectedValues.forEach((value, i) => {
                const optionY = 80 + i * 80;
                const isOptimal = i === results.expectedValueIndex;
                
                // Option node
                svg.append('rect')
                    .attr('x', optionX - 40)
                    .attr('y', optionY - 20)
                    .attr('width', 80)
                    .attr('height', 40)
                    .attr('rx', 5)
                    .attr('class', isOptimal ? 'node-optimal' : 'node-circle');
                
                svg.append('text')
                    .attr('x', optionX)
                    .attr('y', optionY - 5)
                    .attr('class', 'node-text')
                    .style('font-size', '10px')
                    .text(`Opción ${i + 1}`);
                
                svg.append('text')
                    .attr('x', optionX)
                    .attr('y', optionY + 8)
                    .attr('class', 'node-text')
                    .style('font-size', '9px')
                    .text(`VE: ${value.toFixed(2)}`);
                
                if (isOptimal) {
                    svg.append('text')
                        .attr('x', optionX)
                        .attr('y', optionY + 20)
                        .attr('class', 'node-text')
                        .style('font-size', '8px')
                        .text('[Óptima]');
                }
                
                // Connection from start to option
                svg.append('line')
                    .attr('x1', startX + 25)
                    .attr('y1', startY)
                    .attr('x2', optionX - 40)
                    .attr('y2', optionY)
                    .attr('class', 'link');
                
                // Outcome nodes
                results.matrix[i].forEach((returnValue, j) => {
                    const outcomeY = optionY - 30 + j * 20;
                    
                    svg.append('circle')
                        .attr('cx', outcomeX)
                        .attr('cy', outcomeY)
                        .attr('r', 12)
                        .attr('class', 'outcome-node');
                    
                    svg.append('text')
                        .attr('x', outcomeX)
                        .attr('y', outcomeY)
                        .attr('class', 'outcome-text')
                        .style('font-size', '8px')
                        .text(returnValue.toFixed(1));
                    
                    svg.append('line')
                        .attr('x1', optionX + 40)
                        .attr('y1', optionY)
                        .attr('x2', outcomeX - 12)
                        .attr('y2', outcomeY)
                        .attr('class', 'link')
                        .style('stroke-width', 1);
                    
                    svg.append('text')
                        .attr('x', (optionX + outcomeX) / 2)
                        .attr('y', (optionY + outcomeY) / 2 - 5)
                        .attr('class', 'link-text')
                        .style('font-size', '9px')
                        .text(`p=${results.probabilities[j].toFixed(3)}`);
                });
            });

            document.getElementById('download-btn').classList.remove('hidden');
        }

        // Download tree as PNG
        function downloadTreeAsPNG() {
            const container = document.getElementById('tree-container');
            html2canvas(container, { 
                backgroundColor: '#ffffff',
                scale: 2
            }).then(canvas => {
                const link = document.createElement('a');
                link.download = 'decision_tree.png';
                link.href = canvas.toDataURL('image/png');
                link.click();
            }).catch(error => {
                console.error('Error generating PNG:', error);
                alert('Error al generar la imagen. Por favor, intenta de nuevo.');
            });
        }

        // Smooth scrolling functionality
        function smoothScrollTo(element) {
            element.scrollIntoView({
                behavior: 'smooth',
                block: 'start'
            });
        }
        
        // Event listeners
        document.getElementById('calculate-btn').addEventListener('click', function() {
            const results = calculateDecisionCriteria();
            displayResults(results);
            generateTree(results);
        });

        document.getElementById('download-btn').addEventListener('click', downloadTreeAsPNG);

        // Initialize the interface
        initializeInputs();

        // Load sample data
        function loadSampleData() {
            const sampleMatrix = [
                [100, 80, 60, 40],
                [90, 85, 70, 50],
                [110, 75, 65, 35],
                [95, 90, 75, 55]
            ];
            for (let i = 0; i < 4; i++) {
                for (let j = 0; j < 4; j++) {
                    document.getElementById(`matrix-${i * 4 + j}`).value = sampleMatrix[i][j];
                }
            }
        }

        loadSampleData();
    </script>
</body>
</html>
